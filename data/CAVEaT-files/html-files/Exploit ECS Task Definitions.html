<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Segoe UI";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Times;
	panose-1:2 2 6 3 5 4 5 2 3 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	font-size:12.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	font-size:12.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	font-size:12.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	font-size:12.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	font-size:12.0pt;
	font-family:"Calibri",sans-serif;}
.MsoChpDefault
	{font-size:12.0pt;}
 /* Page Definitions */
 @page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=EN-CA link="#0563C1" vlink="#954F72" style='word-wrap:break-word'>

<div class=WordSection1>

<p class=MsoNormal><span lang=EN-US style='font-size:24.0pt;font-family:"Arial",sans-serif'>Exploit
Elastic Container Service (ECS) Task Definitions</span><b><span lang=EN-US
style='font-family:"Times",serif'> </span></b><span lang=EN style='font-family:
"Arial",sans-serif;color:black'>(version 1.0)</span></p>

<p class=MsoNormal><b><span lang=EN-US style='font-size:14.0pt;font-family:
"Arial",sans-serif;color:#39434C'>&nbsp;</span></b></p>

<p class=MsoNormal><b><span lang=EN-US style='font-size:14.0pt;font-family:
"Arial",sans-serif;color:#39434C'>Cloud Service Label:  IaaS, PaaS</span></b></p>

<p class=MsoNormal><b><span lang=EN-US style='font-size:14.0pt;font-family:
"Arial",sans-serif;color:#39434C'>&nbsp;</span></b></p>

<p class=MsoNormal><span lang=EN-US style='font-size:16.0pt;font-family:"Arial",sans-serif'>Description</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:"Arial",sans-serif'>Adversaries
may attempt to exploit the task definitions that are run via Elastic Container
Services on AWS. </span><span lang=EN-US style='font-family:"Arial",sans-serif'>This
tactic can be used to exfiltrate information or escalate privileges. ECS is
AWS’s container management service which is capable of running, stopping, and
managing Docker containers on a cluster.</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:"Arial",sans-serif'>Task
definitions are used to define one or more containers that are to be run and
are required to run Docker containers in ECS. A task definition can specify
parameters such as which Docker image you want to use, the IAM role to be used,
logging configurations, etc.. These task definitions can be exploited to allow
for malicious task definitions to be sent.</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:"Arial",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:16.0pt;font-family:"Arial",sans-serif'>Examples</span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=312 valign=top style='width:3.25in;border:solid black 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US style='font-family:"Arial",sans-serif'>Name</span></b><span
  lang=EN-US style='font-family:"Arial",sans-serif'>&nbsp;</span></p>
  </td>
  <td width=312 valign=top style='width:3.25in;border:solid black 1.0pt;
  border-left:none;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US style='font-family:"Arial",sans-serif'>Description</span></b><span
  lang=EN-US style='font-family:"Arial",sans-serif'>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=312 valign=top style='width:3.25in;border:solid black 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Arial",sans-serif'>Rhino
  Security Labs Blog Post (Pacu Tool)</span></p>
  </td>
  <td width=312 valign=top style='width:3.25in;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Arial",sans-serif;
  color:#404040'>This blog post outlines an attack where an adversary starts
  with a low-level role with access to ECS and then finds a task role that has
  permissions that are elevated to what they need. A task definition is edited
  to be malicious and run a command to pull a shell script from a server being
  hosted by the adversary. A shell script payload to exfiltrate credentials is
  created and then using the AWS CLI is used to run a command that is used to
  run the malicious task definition, this is done using run-task API. The
  adversary can then receive exfiltrated credentials and use them to continue
  attacks.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US style='font-family:"Arial",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:16.0pt;font-family:"Arial",sans-serif'>Mitigations</span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=624
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=312 colspan=2 valign=top style='width:3.25in;border:solid black 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US style='font-family:"Arial",sans-serif'>Mitigation</span></b></p>
  </td>
  <td width=312 valign=top style='width:3.25in;border:solid black 1.0pt;
  border-left:none;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US style='font-family:"Arial",sans-serif'>Description</span></b><span
  lang=EN-US style='font-family:"Arial",sans-serif'>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=312 colspan=2 valign=top style='width:3.25in;border:solid black 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='line-height:107%'><span lang=EN-US
  style='font-size:9.0pt;line-height:107%;font-family:"Arial",sans-serif'>Least
  Privilege </span></p>
  </td>
  <td width=312 valign=top style='width:3.25in;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='line-height:107%'><span lang=EN-US
  style='font-size:9.0pt;line-height:107%;font-family:"Arial",sans-serif;
  color:#404040'>Ensure that the Task Roles attached to ECS task definitions
  are following the principle of least privilege.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border:solid black 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='line-height:107%'><span lang=EN-US
  style='font-size:9.0pt;line-height:107%;font-family:"Arial",sans-serif'>&nbsp;</span></p>
  </td>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><i><span lang=EN-US style='font-size:9.0pt;font-family:
  "Arial",sans-serif'>AWS</span></i></p>
  </td>
  <td width=312 valign=top style='width:3.25in;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Arial",sans-serif'>To
  implement least privilege in an AWS environment IAM policies will be used.
  This gives the ability to allow users to perform list, read, write,
  permissions management, or tagging actions. AWS suggests utilizing <i>last
  accessed information</i> and A<i>WS CloudTrail event history</i> to get a
  better understanding of privileges that might be needed or reduced based on a
  specific role. Full details can be found at <b>https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege.</b></span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border:solid black 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='line-height:107%'><span lang=EN-US
  style='font-size:9.0pt;line-height:107%;font-family:"Arial",sans-serif'>&nbsp;</span></p>
  </td>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><i><span lang=EN-US style='font-size:9.0pt;font-family:
  "Arial",sans-serif'>Azure</span></i></p>
  </td>
  <td width=312 valign=top style='width:3.25in;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Arial",sans-serif'>To
  implement least privilege in an Azure environment Azure Active Directory
  roles will be used. Azure outlines different tasks and the least privileged
  role that are suggested to be associated with the task. Those details can be
  found at:<b>
  https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/roles-delegate-by-task.</b>
  To learn how to assign specific roles it can be done via the Azure Active
  Directory Portal. Instructions on how to assign roles can be found here: <b>https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/directory-manage-roles-portal.</b></span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border:solid black 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='line-height:107%'><span lang=EN-US
  style='font-size:9.0pt;line-height:107%;font-family:"Arial",sans-serif'>&nbsp;</span></p>
  </td>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><i><span lang=EN-US style='font-size:9.0pt;font-family:
  "Arial",sans-serif'>GCP</span></i></p>
  </td>
  <td width=312 valign=top style='width:3.25in;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Arial",sans-serif'>To
  implement least privilege in GCP it is recommended to use predefined roles
  (which allow for granular access permissions) instead of primitive roles
  (roles/owner, roles/editor, and roles/viewer). Full details on the difference
  between types of roles can be found here: <b>https://cloud.google.com/iam/docs/understanding-roles.</b>
  To assign these roles IAM service accounts are used and complete details can
  be found at: <b>https://cloud.google.com/iam/docs/using-iam-securely#least_privilege.</b></span></p>
  </td>
 </tr>
 <tr>
  <td width=312 colspan=2 valign=top style='width:3.25in;border:solid black 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='line-height:107%'><span lang=EN-US
  style='font-size:9.0pt;line-height:107%;font-family:"Arial",sans-serif'>Task
  Definition Edit Privileges </span></p>
  </td>
  <td width=312 valign=top style='width:3.25in;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Arial",sans-serif;
  color:#404040'>If it is necessary to have a task definition run a role that
  requires an elevated level of permission, ensure that that task definition
  cannot be altered by everyone. To properly configure the roles given for task
  definitions, IAM roles will be used. They can specify which users have
  permissions to read, write, and execute the task definitions. To create the
  IAM roles for the task the IAM console will be used. On the console a role
  will be created for an AWS service (Elastic Container Service). Then the
  permissions to be given will be applied via Tags. Once the role is created it
  can be attached to the users needing the permissions. More details can be
  found here: </span><span lang=EN-US style='font-size:9.0pt;font-family:"Arial",sans-serif'>https://docs.aws.amazon.com/AmazonECS/latest/userguide/task-iam-roles.html.</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US style='font-size:18.0pt;font-family:"Arial",sans-serif;
color:black'> </span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:16.0pt;font-family:"Arial",sans-serif'>Detection
</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:"Arial",sans-serif'>This
can be difficult to detect due to the fact that once the attack is completed
the malicious task definition created is deregistered and the environment is in
the same state as it was before the attack occurred. </span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:"Arial",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:16.0pt;font-family:"Arial",sans-serif'>References</span></p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-.25in'><span lang=EN-US
style='font-family:"Arial",sans-serif'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US style='font-family:"Arial",sans-serif'>https://github.com/RhinoSecurityLabs/pacu/tree/master/modules/ecs__enum_task_def</span><span
lang=EN-US style='font-family:"Arial",sans-serif'>. Accessed June 30, 2020.</span></p>

<p class=MsoListParagraphCxSpLast style='text-indent:-.25in'><span lang=EN-US
style='font-family:"Arial",sans-serif'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US style='font-family:"Arial",sans-serif'>https://rhinosecuritylabs.com/aws/weaponizing-ecs-task-definitions-steal-credentials-running-containers/.
Accessed June 30, 2020.</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:22.0pt;font-family:"Arial",sans-serif'>&nbsp;</span></p>

</div>

</body>

</html>
