<html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="Microsoft Word 15 (filtered)" name="Generator"/></head><body link="#0563C1" vlink="#954F72"><div><p>Exploit S3 (Simple Storage Service) Permissions(version 1.0)</p>

<p><b>Cloud Service Label: IaaS, PaaS</b></p>

<p>Description</p>
<p>Adversaries may be able to exploit the permissions of S3 buckets to be able to gain access and exfiltrate data. S3 buckets are Amazon’s Simple Storage Services. They are used to store data such as log files, JavaScript libraries, system backups, images, etc.. This service allows users to store and access data easily, but can be an issue if permissions are not configured properly. This can lead to read access, download permissions to anyone who views the bucket, and open upload permissions, both of which can be exploited by an adversary.</p>

<p>Examples</p>
<table border="1" cellpadding="0" cellspacing="0"><tr><td valign="top" width="312"><p><b>Name</b></p>
</td>
<td valign="top" width="312"><p><b>Description</b></p>
</td>
</tr>
<tr><td valign="top" width="312"><p>Rhino Security Labs Blog Post</p>
</td>
<td valign="top" width="312"><p>In this walkthrough the adversary first finds the region in which they wish to exploit. Once the region is determined they then start to probe for buckets. This is accomplished by general querying and enumeration of bucket names. To determine if a bucket is found that has unfettered access permissions the command, “sudo aws s3 ls s3://$bucketname/ --region $region” can be run with the expectation of returning a directory listing. Once the S3 bucket is identified if an open upload policy can allow an adversary to upload malicious Javascript (or other scripts that are able to perform malicious activity) to all application users. Depending on permissions set buckets can allow for system backups to be downloaded, as well as source code, log files that may contain usernames and passwords, and other critical information. This was tested utilizing Alexa’s top 10,000 sites which resulted in 107 buckets. 57% of the buckets had download permissions to anyone who viewed them, 12% had open upload permissions, and 8% had both permission errors.</p>
</td>
</tr>
<tr><td valign="top" width="312"><p>Twilio S3 Bucket Exploited</p>
</td>
<td valign="top" width="312"><p>The attackers found an open S3 bucket to exploit. Once this was found the JavaScript SDK was altered. The development kit was vandalized as part of an automated cyber-crime campaign that preys on JavaScript code in open S3 buckets to inject malicious ads into browsers.</p>
</td>
</tr>
</table>
<p>Mitigations</p>
<table border="1" cellpadding="0" cellspacing="0" width="624"><tr><td colspan="2" valign="top" width="229"><p><b>Mitigation</b></p>
</td>
<td colspan="2" valign="top" width="395"><p><b>Description</b></p>
</td>
</tr>
<tr><td colspan="2" valign="top" width="229"><p>Web Application Firewall</p>
</td>
<td colspan="2" valign="top" width="395"><p>Ensuring that cloud applications are configured behind a web application firewall can make it harder for an adversary to determine a target’s IP address.</p>
</td>
</tr>
<tr><td valign="top" width="141"><p>Least Privilege</p>

</td>
<td colspan="2" valign="top" width="89">
</td>
<td valign="top" width="394"><p>All access given to users in the cloud environment should be assigned by the necessary privileges needed for team members to complete their job responsibilities.Ensure that temporary access tokens are issued rather than permanent credentials, especially when access is being granted to entities outside of the internal security boundary .</p>
</td>
</tr>
<tr><td valign="top" width="141">
</td>
<td colspan="2" valign="top" width="89"><p>AWS</p>
</td>
<td valign="top" width="394"><p>To implement least privilege in an AWS environment IAM policies will be used. This gives the ability to allow users to perform list, read, write, permissions management, or tagging actions. AWS suggests utilizing<i>last accessed information</i>and A<i>WS CloudTrail event history</i>to get a better understanding of privileges that might be needed or reduced based on a specific role. Full details can be found at<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege"><b>https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege</b></a><b>.</b></p>
</td>
</tr>
<tr><td valign="top" width="141">
</td>
<td colspan="2" valign="top" width="89"><p>Azure</p>
</td>
<td valign="top" width="394"><p>To implement least privilege in an Azure environment Azure Active Directory roles will be used. Azure outlines different tasks and the least privileged role that are suggested to be associated with the task. Those details can be found at:<a href="https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/roles-delegate-by-task"><b>https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/roles-delegate-by-task</b></a><b>.</b>To learn how to assign specific roles it can be done via the Azure Active Directory Portal. Instructions on how to assign roles can be found here:<a href="https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/directory-manage-roles-portal"><b>https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/directory-manage-roles-portal</b></a><b>.</b></p>
</td>
</tr>
<tr><td valign="top" width="141">
</td>
<td colspan="2" valign="top" width="89"><p>GCP</p>
</td>
<td valign="top" width="394"><p><a href="https://cloud.google.com/blog/products/application-development/least-privilege-for-cloud-functions-using-cloud-iam">To implement least privilege in GCP it</a>is recommended to use predefined roles (which allow for granular access permissions) instead of primitive roles (roles/owner, roles/editor, and roles/viewer). Full details on the difference between types of roles can be found here:<a href="https://cloud.google.com/iam/docs/understanding-roles"><b>https://cloud.google.com/iam/docs/understanding-roles</b></a><b>.</b>To assign these roles IAM service accounts are used and complete details can be found at:<a href="https://cloud.google.com/iam/docs/using-iam-securely#least_privilege"><b>https://cloud.google.com/iam/docs/using-iam-securely#least_privilege</b></a><b>.</b></p>
</td>
</tr>
<tr height="0"><td width="141"></td>
<td width="88"></td>
<td width="1"></td>
<td width="394"></td>
</tr>
</table>

<p>Detection</p>
<p>This can be detected by unknown uploads or downloads to/from the S3 buckets.</p>

<p>References</p>
<p>1.https://rhinosecuritylabs.com/penetration-testing/penetration-testing-aws-storage/. Accessed June 30, 2020.</p>
</div></body></html>